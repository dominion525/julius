<!-- 本文開始 -->

<h2>単語グラフ出力</h2>

Julius-3.5 以降では，認識結果を単語グラフ形式で出力することができます．以下は，グラフ形式による結果出力のイメージです．下記のように，有望であった上位の仮説集合全体を単語をノードとするグラフで表します．通常の N-best 文候補よりも多くのパターンをコンパクトに表現でき，多くの単語仮説を残せるため，意味理解や単語検出などの後処理に適しています．<p>
<a href="graphout_fig.jpg"><img src="graphout_fig_small.jpg" alt="Figure of a Word Graph Output" width=320 height=206></a>
<p>
この文書では単語グラフ出力を行う方法，出力結果の読み方について解説します．

<h3>設定</h3>

単語グラフ形式で出力するには，<code>./configure</code> に <code>--enable-graphout</code> をつけてコンパイルしてください．
<p>
実行バイナリについては，<code>--setting</code> でコンパイル時の設定をチェックすることができます．
<pre>
% julius <font color="red">--setting</font>
Julius rev.3.5 (fast)

Engine configuration:
 - Base setup : fast
 - Tunings    : N-gram, <font color="red">GraphOutSearch</font>, LibSndFile
 - Compiled by: gcc -O6 -fomit-frame-pointer
</pre>
上記のように，<code>Tunings</code> の項目に "<code>GraphOutSearch</code>" があれば，この Julius は単語グラフ形式で出力する設定でコンパイルされています．これが無ければ，通常どおり文を出力します．

<h3>出力フォーマット</h3>

単語グラフは以下の2とおりの形式で出力されます．（両方とも出力されます）
<ol>
<li>リスト形式
<li>show形式
</ol>

<h3>リスト形式</h3>

行ごとに単語の詳細な情報を出力します．後処理に適しています．
以下のように開始行から終了行までの間に，1行に1単語ずつ出力されます．
<pre>
--- begin wordgraph data ---
....
5: left=2,4 right=6 [95..136] wid=15934 name="注文" lname="注文+チューモン+17"
   f=-10768.260742 f_prev=-10759.538086 g_head=-8292.633789 g_prev=-7252.952637
   lscore=-35.431999 AMavg=-23.910694 cmscore=0.278056
....
--- end wordgraph data---
</pre>
各値の意味は以下の通りです．
<dl>
<dt><strong>5:</strong>
<dd>ID (0から始まる通し番号)
<dt><strong>left=2,4</strong>
<dd>直前（左）に接続する単語のIDリスト．接続単語がない場合は出力されない．
<dt><strong>right=6</strong>
<dd>直後（右）に接続する単語のIDリスト．接続単語がない場合は出力されない．
<dt><strong>[95..136]</strong>
<dd>マッチしたフレーム区間
<dt><strong>wid=15934</strong>
<dd>単語の辞書番号
<dt><strong>name="注文"</strong>
<dd>単語の出力文字列
<dt><strong>lname="注文+チューモン+17"</strong>
<dd>N-gramエントリ（julius），あるいはカテゴリ番号（Julian）
<dt><strong>f=-10768.260742</strong>
<dd>この単語から次の単語（左単語）を展開したときの文スコア（h(w_left) + g(w)）
<dt><strong>f_prev=-10759.538086</strong>
<dd>直前単語（右単語）からこの単語を展開したときの文スコア （h(w) + g(w_right)）
<dt><strong>g_head=-8292.633789</strong>
<dd>単語の始端（左端）状態から入力末尾までの累積スコア （g(w)）
<dt><strong>g_prev=-7252.952637</strong>
<dd>単語の終端（右端）状態から入力末尾までの累積スコア（終端状態の出力確率は含まない）
<dt><strong>lscore=-35.431999</strong>
<dd>言語スコア（Julius のみ，Julian では出力されない）
<dt><strong>AMavg=-23.910694</strong>
<dd>フレーム平均音響スコア．"(g_head - g_prev) / 区間フレーム長" で算出される．
<dt><strong>cmscore=0.278056</strong>
<dd><a href="cm.html">単語信頼度</a>
</dl>
なお，グラフの末端などで接続する単語がない場合，"left=" や "right=" が出力されない点に注意してください．

<p>
<h3>show形式</h3>

グラフ中の単語の位置を端末上で直感的に掴める形式です．
以下のように，<code>--- begin wordgraph show ---</code>の行と
<code>--- end wordgraph show---</code>の間に1行に1単語ずつ出力されます．
<p>
横幅(76文字分)を入力全体として，単語のマッチングした区間の
順に出力します．マッチング区間を表すバーの行の左端の値がその開始フレーム，
単語名の行の左端の値が ID（0から始まる通し番号）です．以下に例を示します．
<pre>
-------------------------- begin wordgraph show -------------------------
   4: 
   0:|------|
   8: 
   0:|---|
   0:     バー
  16:    |----|
   9:     バス
  16:    |---------|
   5:        明日
  25:       |------|
   1:           ス
  34:          |---|
  10:                の
  51:               |--|
  11:                   時刻
  63:                  |--------|
   7:                            教え
  94:                           |------------|
  12:                            を
  94:                           |---|
   2:                                おしえ
 106:                               |--------|
   3:                                押し
 106:                               |--------|
  13:                                教え
 106:                               |--------|
  14:                                         て
 136:                                        |--|
   6:                                            ください
 148:                                           |--------------|
  15:                                            下さい
 148:                                           |--------------|
  16:                                                            。
 199:                                                           |--------|
  17:                                                                      
 233:                                                                     ||
-------------------------- end wordgraph show ---------------------------
</pre>

<h3>出力の調整</h3>

得られる単語数は，オプションの文仮説発見数 "<code>-n</code>" に依存します．値を大きくするほど多くの単語仮説が得られます．
<p>
通常，この "-n" の値は得られる文仮説数を表しますが，単語グラフ出力モード
では探索途中に仮説のマージや中断を行うため，実際にはこの値以上の仮説の
グラフが得られます．例えば "<code>-n 10</code>"とすると通常は上位 10 個の
文仮説を出力しますが，単語グラフ出力モードでは探索途中に似た仮説の展開中断
を行いながらグラフを生成しますので，通常の 10 ベストよりも多くの解の
バリエーションが得られます．

<!-- 本文終了 -->
<hr>
<div align="right">
$Id: graphout.html,v 1.1.1.1 2007/01/10 08:01:57 kudravka_ Exp $
</div>

